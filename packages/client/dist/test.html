<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½åŠ©æ‰‹æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .feature {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }
        
        .feature-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }
        
        .instructions {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .status {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 14px;
        }
        
        .status.connected {
            background: rgba(46, 204, 113, 0.9);
        }
        
        .status.disconnected {
            background: rgba(231, 76, 60, 0.9);
        }
    </style>
</head>
<body>
    <div class="status" id="status">æ­£åœ¨è¿æ¥...</div>
    
    <div class="container">
        <h1>ğŸ¤– æ™ºèƒ½ç½‘é¡µåŠ©æ‰‹</h1>
        
        <div class="instructions">
            <h3>ğŸ“‹ ä½¿ç”¨è¯´æ˜</h3>
            <p>1. æŸ¥çœ‹å³ä¸‹è§’çš„æ‚¬æµ®æŒ‰é’®ï¼ˆç´«è‰²åœ†å½¢å›¾æ ‡ï¼‰</p>
            <p>2. ç‚¹å‡»æ‚¬æµ®æŒ‰é’®æ‰“å¼€å¯¹è¯æ¡†</p>
            <p>3. è¾“å…¥æ¶ˆæ¯å’ŒAIåŠ©æ‰‹èŠå¤©</p>
            <p>4. å°è¯•é—®ä¸€äº›å…³äºè¿™ä¸ªé¡µé¢çš„é—®é¢˜</p>
        </div>
        
        <div class="feature-list">
            <div class="feature">
                <div class="feature-icon">ğŸ’¬</div>
                <h3>æ™ºèƒ½å¯¹è¯</h3>
                <p>ä¸AIåŠ©æ‰‹è¿›è¡Œè‡ªç„¶è¯­è¨€å¯¹è¯</p>
            </div>
            
            <div class="feature">
                <div class="feature-icon">ğŸ“„</div>
                <h3>é¡µé¢åˆ†æ</h3>
                <p>åˆ†æå½“å‰ç½‘é¡µå†…å®¹å¹¶å›ç­”é—®é¢˜</p>
            </div>
            
            <div class="feature">
                <div class="feature-icon">ğŸ”</div>
                <h3>ä¿¡æ¯æŸ¥æ‰¾</h3>
                <p>å¸®åŠ©æŸ¥æ‰¾é¡µé¢ä¸­çš„ç‰¹å®šä¿¡æ¯</p>
            </div>
            
            <div class="feature">
                <div class="feature-icon">ğŸ’¡</div>
                <h3>æ™ºèƒ½å»ºè®®</h3>
                <p>æ ¹æ®é¡µé¢å†…å®¹æä¾›ç›¸å…³å»ºè®®</p>
            </div>
        </div>
        
        <div class="instructions">
            <h3>ğŸ® è¯•è¯•è¿™äº›å¯¹è¯</h3>
            <ul>
                <li>"ä½ å¥½" - é—®å€™åŠ©æ‰‹</li>
                <li>"è¿™ä¸ªé¡µé¢æ˜¯åšä»€ä¹ˆçš„ï¼Ÿ" - è¯¢é—®é¡µé¢ä¿¡æ¯</li>
                <li>"å¸®åŠ©" - æŸ¥çœ‹åŠŸèƒ½è¯´æ˜</li>
                <li>"æœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Ÿ" - äº†è§£åŠ©æ‰‹èƒ½åŠ›</li>
            </ul>
        </div>
    </div>

    <!-- åŠ è½½æ™ºèƒ½åŠ©æ‰‹SDKå’Œæ ·å¼ -->
    <script type="module">
        // è‡ªåŠ¨æ£€æµ‹å¯ç”¨ç«¯å£
        async function detectPorts() {
            console.log('ğŸ” è‡ªåŠ¨æ£€æµ‹è¿è¡Œç«¯å£...')
            
            // æ£€æµ‹å®¢æˆ·ç«¯ç«¯å£ (Vite)
            let clientPort = null
            for (let port = 3000; port <= 3010; port++) {
                try {
                    const response = await fetch(`http://localhost:${port}/src/index.ts`, { method: 'HEAD' })
                    if (response.ok) {
                        clientPort = port
                        break
                    }
                } catch (e) {
                    // ç«¯å£ä¸å¯ç”¨ï¼Œç»§ç»­å°è¯•ä¸‹ä¸€ä¸ª
                }
            }
            
            // æ£€æµ‹æœåŠ¡ç«¯ç«¯å£
            let serverPort = null
            for (let port = 3001; port <= 3010; port++) {
                try {
                    const response = await fetch(`http://localhost:${port}/health`)
                    if (response.ok) {
                        serverPort = port
                        break
                    }
                } catch (e) {
                    // ç«¯å£ä¸å¯ç”¨ï¼Œç»§ç»­å°è¯•ä¸‹ä¸€ä¸ª
                }
            }
            
            console.log(`ğŸ” æ£€æµ‹åˆ°ç«¯å£: å®¢æˆ·ç«¯=${clientPort}, æœåŠ¡ç«¯=${serverPort}`)
            return { clientPort, serverPort }
        }
        
        // åˆå§‹åŒ–æ™ºèƒ½åŠ©æ‰‹
        async function initAssistant() {
            try {
                console.log('ğŸ”„ å¼€å§‹åˆå§‹åŒ–æ™ºèƒ½åŠ©æ‰‹...')
                
                const { clientPort, serverPort } = await detectPorts()
                
                if (!clientPort) {
                    throw new Error('æœªæ‰¾åˆ°å®¢æˆ·ç«¯å¼€å‘æœåŠ¡å™¨')
                }
                
                if (!serverPort) {
                    throw new Error('æœªæ‰¾åˆ°æœåŠ¡ç«¯å¼€å‘æœåŠ¡å™¨')
                }
                
                // åŠ¨æ€å¯¼å…¥æ¨¡å—
                const { init } = await import(`http://localhost:${clientPort}/src/index.ts`)
                
                const assistant = init({
                    apiKey: 'test-key-123', // æµ‹è¯•ç”¨çš„API Key
                    serverUrl: `http://localhost:${serverPort}`, // è‡ªåŠ¨æ£€æµ‹çš„æœåŠ¡å™¨åœ°å€
                    position: 'bottom-right',
                    theme: 'auto'
                })
            
                console.log('âœ… æ™ºèƒ½åŠ©æ‰‹åˆå§‹åŒ–æˆåŠŸ', assistant)
                
                // ç›‘å¬è¿æ¥çŠ¶æ€
                window.addEventListener('assistant:status', (event) => {
                    const statusEl = document.getElementById('status')
                    const { connected } = event.detail
                    
                    if (connected) {
                        statusEl.textContent = 'ğŸŸ¢ å·²è¿æ¥'
                        statusEl.className = 'status connected'
                    } else {
                        statusEl.textContent = 'ğŸ”´ æœªè¿æ¥'
                        statusEl.className = 'status disconnected'
                    }
                })
                
            } catch (error) {
                console.error('âŒ æ™ºèƒ½åŠ©æ‰‹åˆå§‹åŒ–å¤±è´¥:', error)
                document.getElementById('status').textContent = 'âŒ åˆå§‹åŒ–å¤±è´¥'
            }
        }
        
        // å¯åŠ¨åˆå§‹åŒ–
        initAssistant()
    </script>
</body>
</html>